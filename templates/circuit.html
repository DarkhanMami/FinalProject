{% extends 'base.html' %}

{% block content %}
    <div class="row">
        <div class="col-lg-3">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Number of qubits" id="qubits">
            <span class="input-group-btn">
              <button class="btn btn-default" type="button" onclick="new_circuit()">New Gate</button>
            </span>
          </div>
        </div>
    </div>
    <div class="row">
      <div class="col-sm-4"><h4><strong>Gates</strong></h4></div>
      <div class="col-sm-4"><h4><strong>SWAP Gates</strong></h4></div>
      <div class="col-sm-4"><h4><strong>Rotations</strong></h4></div>
    </div>
    <div class="row"> 
      <div class="col-sm-4">
        <table class="table table-sm table-bordered" style="font-size:12px">          
            <th class="col-xs-2">Name</th>
            <th class="col-xs-1">Target</th>
            <th class="col-xs-1">Control</th>
          </thead>
          <tbody>
            <tr>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_types" value="Hadamard" disabled></td>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_targets"></td>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_controls" disabled></td>
            </tr>
            <tr>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_types" value="SQRTNOT" disabled></td>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_targets">
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_controls" disabled></td>
            </tr>
            <tr>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_types" value="CNOT" disabled></td>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_targets">
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_controls"></td>
            </tr>
            <tr>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_types" value="CSIGN" disabled></td>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_targets">
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_controls"></td>
            </tr>
            <tr>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_types" value="BERKELEY" disabled></td>
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_targets">
              <td><input style="font-size:10px" class="form-control input-sm" type="text" name="g_controls" disabled></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col-sm-4">
        <table class="table table-sm table-bordered" style="font-size:12px">          
            <th class="col-xs-2">Type</th>
            <th class="col-xs-1">Target</th>
            <th class="col-xs-1">angle (pi/)</th>
          </thead>
          <tbody>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_types" value="SWAPALPHA" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_targets"></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_angle"></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_types" value="SWAP" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_angle" disabled></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_types" value="ISWAP" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_angle" disabled></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_types" value="SQRTISWAP" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_angle" disabled></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_types" value="SQRTSWAP" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="s_angle" disabled></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col-sm-4">
        <table class="table table-sm table-bordered" style="font-size:12px">          
            <th class="col-xs-2">Type</th>
            <th class="col-xs-1">Target</th>
            <th class="col-xs-1">angle (pi/)</th>
          </thead>
          <tbody>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_types" value="RX" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_targets"></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_angle"></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_types" value="RY" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_angle"></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_types" value="RZ" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_angle"></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_types" value="PHASEGATE" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_angle"></td>
            </tr>
            <tr>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_types" value="GLOBALPHASE" disabled></td>
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_targets">
              <td><input style="font-size:11px" class="form-control input-sm" type="text" name="r_angle"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4"><button class="btn btn-default" onclick="send()"> Add Gate </button></div>
      <div class="col-sm-4"><button class="btn btn-default" onclick="new_swap()"> Add SWAP </button></div>
      <div class="col-sm-4"><button class="btn btn-default" onclick="new_rotation()"> Add Rotation </button></div>
    </div>
    <hr>
    <div class="row">
        <div class="col-lg-4">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Index" id="gate_ind">
            <span class="input-group-btn">
              <button class="btn btn-default" type="button" onclick="remove_gate()">Remove gate by index</button>
            </span>
          </div>
        </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <img id="image"></img>
      </div>
      <div class="col-sm-8">
        <table class="table table-striped table-bordered table-condensed" id="result" style="font-size:9px"></table>
      </div>
    </div>

{% endblock %}

{% block script %}

    <script>
        function new_circuit() {
          var form = new FormData();
          form.append("N", $("#qubits").val())

            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "http://localhost:8000/new_circuit/",
              "method": "POST",
              "processData": false,
              "contentType": false,
              "mimeType": "multipart/form-data",
              "data": form
            };

            $.ajax(settings).done(function (response) {
              // $("#result").html(response);

              var rowHtml = '';
              var n = 0;
              if ($("#qubits").val() == 1){
                n = 2;
              } else {
                n = Math.pow(2, $("#qubits").val())
              }
              var i = 0;

              for (row = 0; row < n; row++) {
                rowHtml+='<tr>';
                for (col = 0; col < n; col++) {
                  rowHtml+='<td>'+"0"+'</td>';
                  i++;
                }
                rowHtml+='</tr>';
              }
              

              $("#result").html(rowHtml);
              $("#image").attr("src", "/static/qcirc.png?v=" + new Date().getTime());
            });

        }

        function remove_gate() {
          var form = new FormData();
          form.append("ind", $("#gate_ind").val())

            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "http://localhost:8000/remove_gate/",
              "method": "POST",
              "processData": false,
              "contentType": false,
              "mimeType": "multipart/form-data",
              "data": form
            };

            $.ajax(settings).done(function (response) {
              var myMap = JSON.parse(response);
              var myList = myMap['matrix'];
              var rowHtml = '';

              if (myList.length < 2) {
                var n = 0;
                if ($("#qubits").val() == 1){
                  n = 2;
                } else {
                  n = Math.pow(2, $("#qubits").val())
                }
                var i = 0;

                for (row = 0; row < n; row++) {
                  rowHtml+='<tr>';
                  for (col = 0; col < n; col++) {
                    rowHtml+='<td>'+"0"+'</td>';
                    i++;
                  }
                  rowHtml+='</tr>';
                }
              } else {
                var n = 0;
                if ($("#qubits").val() == 1){
                  n = 2;
                } else {
                  n = Math.pow(2, $("#qubits").val())
                }
                var i = 0;

                for (row = 0; row < n; row++) {
                  rowHtml+='<tr>';
                  for (col = 0; col < n; col++) {
                    rowHtml+='<td>'+myList[i]+'</td>';
                    i++;
                  }
                  rowHtml+='</tr>';
                }
              }

              $("#result").html(rowHtml);

              $("#image").attr("src", "/static/qcirc.png?v=" + new Date().getTime());
              $("#gate_ind").val('');
            });           

        }

        function send() {
            var form = new FormData();
            $('input[name=g_types]').each(function(i, v) {
                form.append("types[]", v.value);
            });
            $('input[name=g_targets]').each(function(i, v) {
                form.append("targets[]", v.value);
            });
            $('input[name=g_controls]').each(function(i, v) {
                form.append("controls[]", v.value);
            });

            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "http://localhost:8000/calculate/",
              "method": "POST",
              "processData": false,
              "contentType": false,
              "mimeType": "multipart/form-data",
              "data": form
            };

            $.ajax(settings).done(function (response) {
              var myMap = JSON.parse(response);
              var myList = myMap['matrix'];
              var rowHtml = '';

              console.log(myList)

              var n = 0;
              if ($("#qubits").val() == 1){
                n = 2;
              } else {
                n = Math.pow(2, $("#qubits").val())
              }
              var i = 0;

              for (row = 0; row < n; row++) {
                rowHtml+='<tr>';
                for (col = 0; col < n; col++) {
                  rowHtml+='<td>'+myList[i]+'</td>';
                  i++;
                }
                rowHtml+='</tr>';
              }
              

              $("#result").html(rowHtml);




              $("#image").attr("src", "/static/qcirc.png?v=" + new Date().getTime());
              $('input[name=g_targets]').each(function(i, v) {
                  v.value = '';
              });
              $('input[name=g_controls]').each(function(i, v) {
                  v.value = '';
              });
            });
        }

        function new_rotation() {
            var form = new FormData();
            $('input[name=r_types]').each(function(i, v) {
                form.append("types[]", v.value);
            });
            $('input[name=r_targets]').each(function(i, v) {
                form.append("targets[]", v.value);
            });
            $('input[name=r_angle]').each(function(i, v) {
                form.append("angles[]", v.value);
            });

            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "http://localhost:8000/new_rotation/",
              "method": "POST",
              "processData": false,
              "contentType": false,
              "mimeType": "multipart/form-data",
              "data": form
            };

            $.ajax(settings).done(function (response) {
              var myMap = JSON.parse(response);
              var myList = myMap['matrix'];
              var rowHtml = '';


              var n = 0;
              if ($("#qubits").val() == 1){
                n = 2;
              } else {
                n = Math.pow(2, $("#qubits").val())
              }
              var i = 0;

              for (row = 0; row < n; row++) {
                rowHtml+='<tr>';
                for (col = 0; col < n; col++) {
                  rowHtml+='<td>'+myList[i]+'</td>';
                  i++;
                }
                rowHtml+='</tr>';
              }
              

              $("#result").html(rowHtml);
              $("#image").attr("src", "/static/qcirc.png?v=" + new Date().getTime());
              $('input[name=r_targets]').each(function(i, v) {
                  v.value = '';
              });
              $('input[name=r_angle]').each(function(i, v) {
                  v.value = '';
              });
            });
        }

        function new_swap() {
            var form = new FormData();
            $('input[name=s_types]').each(function(i, v) {
                form.append("types[]", v.value);
            });
            $('input[name=s_targets]').each(function(i, v) {
                form.append("targets[]", v.value);
            });
            $('input[name=s_angle]').each(function(i, v) {
                form.append("angles[]", v.value);
            });

            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "http://localhost:8000/new_swap/",
              "method": "POST",
              "processData": false,
              "contentType": false,
              "mimeType": "multipart/form-data",
              "data": form
            };

            $.ajax(settings).done(function (response) {
              var myMap = JSON.parse(response);
              var myList = myMap['matrix'];
              var rowHtml = '';


              var n = 0;
              if ($("#qubits").val() == 1){
                n = 2;
              } else {
                n = Math.pow(2, $("#qubits").val())
              }
              var i = 0;

              for (row = 0; row < n; row++) {
                rowHtml+='<tr>';
                for (col = 0; col < n; col++) {
                  rowHtml+='<td>'+myList[i]+'</td>';
                  i++;
                }
                rowHtml+='</tr>';
              }
              

              $("#result").html(rowHtml);
              $("#image").attr("src", "/static/qcirc.png?v=" + new Date().getTime());
              $('input[name=s_targets]').each(function(i, v) {
                  v.value = '';
              });
              $('input[name=s_angle]').each(function(i, v) {
                  v.value = '';
              });

            });
        }

    </script>
{% endblock %}
